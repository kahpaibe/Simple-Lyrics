<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Regular Expression Lyrics Display</title>
    <link rel="stylesheet" type="text/css" href="styles.css" />
    <script>
      function applyRegex() {
        var inputJapanese = document.getElementById("japaneseInput").value;
        var inputText2 = document.getElementById("englishInput").value;
        var inputTitle = document.getElementById("titleInput").value;
        var inputSubtitle = document.getElementById("subtitleInput").value;

        inputJapanese = inputJapanese.replace(/(\r\n|\r|\n)/g, " <br> "); // Replace new lines with <br> tags
        inputJapanese += " <br>"; // Append text at the end of the inputText
        inputTitle = inputTitle.replace(/(\r\n|\r|\n)/g, " <br> "); // Replace new lines with <br> tags
        inputTitle += " "; // Append text at the end of the inputText

        var regexPattern = /(\S+?)\[(.+?)\](.*?)[\s\n\r$]/g; // Regex pattern for the specified substitution
        var rubyresult = inputJapanese.replace(
          regexPattern,
          "<ruby><rb>$1</rb><rt>$2</rt></ruby>$3"
        ); // Replace matches with the specified format
        var titleruby = inputTitle.replace(
          regexPattern,
          "<ruby><rb>$1</rb><rt>$2</rt></ruby>$3"
        ); // Replace matches with the specified format

        var lines = inputText2.split(/\r?\n/); // Split text from second input box into lines
        var rubyresultLines = rubyresult.split("<br>"); // Split result into lines

        var alignedResult = ""; // String to store aligned result

        // Loop through each line from the second input box and its corresponding line from the result
        for (var i = 0; i < lines.length; i++) {
          alignedResult +=
            '<div class="line"><div class="japanese-text" style="font-size: ' +
            document.getElementById("japaneseFontSize").value +
            'px;">' +
            rubyresultLines[i] +
            '</div><div class="english-text" style="font-size: ' +
            document.getElementById("englishFontSize").value +
            'px;">' +
            lines[i] +
            "</div></div>";
        }

        document.getElementById("alignedDisplay").innerHTML = alignedResult; // Display aligned result

        // Display raw substitution result
        document.getElementById("rawResult").textContent = rubyresult;

        // Set titles
        document.getElementById("Title").innerHTML = titleruby;
        document.getElementById("subTitle").textContent = inputSubtitle;

        // Set font sizes for h1 and h2
        document.querySelector("h1").style.fontSize =
          document.getElementById("h1FontSize").value + "px";
        document.querySelector("h2").style.fontSize =
          document.getElementById("h2FontSize").value + "px";
      }
      function makePrintTab() {
        var title = document.getElementById("Title").innerHTML;
        var subtitle = document.getElementById("subTitle").textContent;
        var alignedContent =
          document.getElementById("alignedDisplay").innerHTML;

        var printWindow = window.open("", "_blank");

        // import css styles
        printWindow.document.write(
          '<link rel="stylesheet" type="text/css" href="styles.css" />'
        );

        printWindow.document.write(
          "<html><head><title>Printed Content</title></head><body>"
        );

        printWindow.document.write("<h1>" + title + "</h1>");
        printWindow.document.write("<h2>" + subtitle + "</h2>");
        printWindow.document.write("<div>" + alignedContent + "</div>");

        printWindow.document.write("</body></html>");
      }
      function callPrintTab() {
        applyRegex();
        makePrintTab();
      }
    </script>
  </head>
  <body>
    <button class="print-button" onclick="callPrintTab()">Print Content</button>
    <div class="slider-container">
      <label class="slider-label" for="japaneseFontSize"
        >Japanese Font Size:</label
      >
      <input
        class="slider"
        type="range"
        id="japaneseFontSize"
        min="10"
        max="50"
        value="16"
        onchange="applyRegex()"
      />
    </div>
    <div class="slider-container">
      <label class="slider-label" for="englishFontSize"
        >English Font Size:</label
      >
      <input
        class="slider"
        type="range"
        id="englishFontSize"
        min="10"
        max="50"
        value="16"
        onchange="applyRegex()"
      />
    </div>

    <div class="slider-container">
      <label class="slider-label" for="h1FontSize">Title Font Size:</label>
      <input
        class="slider"
        type="range"
        id="h1FontSize"
        min="10"
        max="50"
        value="24"
        onchange="applyRegex()"
      />
    </div>
    <div class="slider-container">
      <label class="slider-label" for="h2FontSize">Subtitle Font Size:</label>
      <input
        class="slider"
        type="range"
        id="h2FontSize"
        min="10"
        max="50"
        value="20"
        onchange="applyRegex()"
      />
    </div>
    <div class="container">
      <div class="title-container">
        <label for="titleInput">Title</label><br />
        <input type="text" id="titleInput" />
      </div>
      <div class="title-container">
        <label for="subtitleInput">Subtitle</label><br />
        <input type="text" id="subtitleInput" />
      </div>
    </div>
    <div class="container">
      <div class="japanese-container">
        <label for="japaneseInput">Japanese</label><br />
        <textarea id="japaneseInput" rows="12" cols="50"></textarea>
      </div>
      <div class="english-container">
        <label for="englishInput">Translation</label><br />
        <textarea id="englishInput" rows="12" cols="50"></textarea>
      </div>
    </div>
    <button onclick="applyRegex()">Apply Regex</button><br />

    <h1><div id="Title"></div></h1>
    <h2><div id="subTitle"></div></h2>
    <label for="alignedDisplay">Aligned Result:</label><br />
    <div id="alignedDisplay"></div>
    <label for="rawResult">Raw Substitution Result:</label><br />
    <div id="rawResult"></div>
  </body>
</html>
